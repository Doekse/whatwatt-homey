<!DOCTYPE html>
<html>
<head>
<style>
  .instructions {
    text-align: left;
    margin-top: 20px;
    margin-bottom: 20px;
    line-height: 1.5;
    color: #333;
  }
  
  .device-image {
    display: block;
    width: 450px;
    max-width: 100%;
    margin: 30px auto;
    border-radius: 8px;
  }
</style>
</head>
<body>
<header id="hy-header">
  <h1 class="homey-title homey-text-align-center">
    <span id="hy-header-title" data-i18n="pair.password_input.title">Device Protection</span>
    <span id="hy-header-badge" class="homey-title-badge"></span>
  </h1>
  <h2 id="hy-header-subtitle" class="homey-subtitle homey-text-align-center" data-i18n="pair.password_input.subtitle">Please provide a password if device protection is enabled</h2>
</header>

<img src="password_input.assets/device protection.png" alt="Device Protection" class="device-image">

<p class="instructions" data-i18n="pair.password_input.instructions">Please check if your whatwatt Go has "Device Protection" enabled. You can do this by checking the device settings in the web-UI. If enabled, enter the password below. If disabled, leave the field empty. Afterward, press "Continue" to proceed with the pairing</p>

<div style="margin: 0 0 20px 0;">
  <label class="homey-form-label" for="ww-password" data-i18n="pair.password_input.password_label">Password</label>
  <input
    id="ww-password"
    class="homey-form-input"
    type="password"
    data-i18n-placeholder="pair.password_input.password_placeholder"
    placeholder="Password"
  />
</div>

<button
  id="ww-continue"
  class="homey-button-primary-shadow-full"
  data-i18n="pair.password_input.continue_button"
>Continue</button>

    <script type="application/javascript">
        const $password = document.getElementById('ww-password');
        const $continue = document.getElementById('ww-continue');

        $continue.addEventListener('click', async () => {
            if ($continue.classList.contains('is-loading')) return;
            $continue.classList.add('is-loading');

            try {
                const password = $password.value.trim();
                console.log('Emitting password_entered with:', password ? '***' : '(empty)');
                
                // Send password to driver
                await Homey.emit('password_entered', { password });
                
                // Proceed to next view
                await Homey.nextView();
            } catch (error) {
                console.error('Error:', error);
                Homey.alert(Homey.__('pair.password_input.error_message'));
            } finally {
                $continue.classList.remove('is-loading');
            }
        });
        // Focus on password input when view loads
        $password.focus();
    </script>
</body>
</html>
